<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="UserManagementApp.Views.HomePage"
             Title="Home"
             Shell.NavBarIsVisible="True">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <!-- Search Bar -->
            <SearchBar Placeholder="Search for restaurant or dish"
                 Text="{Binding SearchText}"
                 SearchCommand="{Binding RefreshFilter}"
                 />

            <!-- Category Tabs -->
            <CollectionView ItemsSource="{Binding Categories}"
                      ItemsLayout="HorizontalList"
                      SelectionMode="Single"
                      SelectedItem="{Binding SelectedCategory}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="10"
                   Margin="0,0,10,0"
                   CornerRadius="20"
                   HasShadow="False"
                   BackgroundColor="{Binding IsSelected, Converter={StaticResource BoolToColorConverter}}">
                            <Label Text="{Binding Name}" VerticalOptions="Center"/>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Food Cards -->
            <CollectionView ItemsSource="{Binding FilteredFoodItems}"
                      ItemsLayout="HorizontalList"
                      HeightRequest="300">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame WidthRequest="200"
                   CornerRadius="10"
                   HasShadow="True"
                   Margin="0,0,15,0"
                   Padding="0">
                            <Grid RowDefinitions="2*,3*" ColumnDefinitions="*">

                                <!-- Dish Image -->
                                <Image Source="{Binding ImageUrl}"
                       Aspect="AspectFill"
                       Grid.Row="0"/>

                                <!-- Details -->
                                <VerticalStackLayout Grid.Row="1" Padding="10" Spacing="5">

                                    <Label Text="{Binding Name}"
                         FontAttributes="Bold"
                         LineBreakMode="TailTruncation"/>

                                    <HorizontalStackLayout Spacing="5">
                                        <Label Text="₹" FontSize="12"/>
                                        <Label Text="{Binding Price}" FontSize="16" FontAttributes="Bold"/>
                                        <Label Text="₹{Binding OfferPrice}" TextColor="Green" FontSize="12"
                           IsVisible="{Binding OfferPrice, Converter={StaticResource NullToBoolConverter}}"/>
                                    </HorizontalStackLayout>

                                    <HorizontalStackLayout Spacing="3" VerticalOptions="Center">
                                        <Label Text="{Binding Rating}" FontSize="12"/>
                                        <Label Text="★" TextColor="Gold" FontSize="12"/>
                                    </HorizontalStackLayout>

                                    <Label Text="{Binding DeliveryInfo}" FontSize="12" TextColor="Gray"/>

                                    <!-- Tags -->
                                    <FlexLayout Wrap="Wrap" Direction="Row">
                                        <Frame Style="{StaticResource TagFrameStyle}"
                           IsVisible="{Binding Tags.Count, Converter={StaticResource GreaterThanZeroConverter}}">
                                            <Label Text="{Binding .}"
                             Style="{StaticResource TagLabelStyle}"
                             BindingContext="{Binding}"/>
                                        </Frame>
                                    </FlexLayout>

                                </VerticalStackLayout>

                            </Grid>
                        </Frame>

                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <CollectionView ItemsSource="{Binding TrendingNow}"
                HeightRequest="300">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout
                      Orientation="Horizontal"
                      ItemSpacing="15" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame WidthRequest="200"
                                 CornerRadius="10"
                                 HasShadow="True"
                                 Margin="0,0,15,0"
                                 Padding="0">
                            <!-- reuse the same template as above -->
                            <Grid RowDefinitions="2*,3*">
                                <Image Source="{Binding ImageUrl}"
                                         Aspect="AspectFill"
                                         Grid.Row="0"/>
                                <VerticalStackLayout Grid.Row="1" Padding="10" Spacing="5">
                                    <Label Text="{Binding Name}"
                                           FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"/>
                                    <HorizontalStackLayout Spacing="5">
                                        <Label Text="₹" FontSize="12"/>
                                        <Label Text="{Binding Price}"
                                                 FontSize="16"
                                                 FontAttributes="Bold"/>
                                    </HorizontalStackLayout>
                                    <HorizontalStackLayout Spacing="3">
                                        <Label Text="{Binding Rating}" FontSize="12"/>
                                        <Label Text="★" TextColor="Gold" FontSize="12"/>
                                    </HorizontalStackLayout>
                                    <Label Text="{Binding DeliveryInfo}" FontSize="12" TextColor="Gray"/>
                                    <FlexLayout Wrap="Wrap" Direction="Row">
                                        <Frame Style="{StaticResource TagFrameStyle}"
                                             IsVisible="{Binding Tags.Count, Converter={StaticResource GreaterThanZeroConverter}}">
                                                                    <Label Text="{Binding .}"
                                               Style="{StaticResource TagLabelStyle}"
                                               BindingContext="{Binding}"/>
                                        </Frame>
                                    </FlexLayout>
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>

        <!--<VerticalStackLayout Padding="20">
            <Label Text="Welcome!" FontSize="24" HorizontalOptions="Center" />
            <Button Text="Logout"
             BackgroundColor="DarkRed"
             TextColor="White"
             Command="{Binding LogoutCommand}" />
        </VerticalStackLayout>-->
    </ScrollView>

</ContentPage>